<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - Myntra</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .is-invalid {
        border-color: #dc3545 !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
      }
      .invalid-feedback {
        display: none;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 0.875em;
        color: #dc3545;
      }
      .was-validated .form-control:invalid ~ .invalid-feedback,
      .form-control.is-invalid ~ .invalid-feedback {
        display: block;
      }
      .form-control:focus {
        border-color: #fd5c63;
        box-shadow: 0 0 0 0.25rem rgba(253, 92, 99, 0.25);
      }
      .password-strength {
        height: 4px;
        margin-top: 0.25rem;
        background-color: #e9ecef;
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }
      .password-strength-bar {
        height: 100%;
        width: 0;
        transition: width 0.3s ease, background-color 0.3s ease;
      }
      .password-requirements {
        font-size: 0.8rem;
        color: #6c757d;
        margin-top: 0.25rem;
      }
      .requirement {
        display: flex;
        align-items: center;
        margin-bottom: 0.25rem;
      }
      .requirement.valid {
        color: #198754;
      }
      .requirement.invalid {
        color: #6c757d;
      }
      .requirement i {
        margin-right: 0.5rem;
        font-size: 0.7rem;
      }
      .btn .spinner-border {
        margin-right: 0.5rem;
      }
      .btn .button-text {
        display: inline-block;
      }
      .btn.is-loading .button-text {
        visibility: hidden;
      }
      .btn.is-loading .spinner-border {
        display: inline-block !important;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }
      .terms-link {
        cursor: pointer;
        color: #0d6efd;
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div id="site-header"></div>

    <div class="container my-5">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
          <div class="card shadow">
            <div class="card-body p-4">
              <h2 class="text-center mb-4">Create an Account</h2>
              <div id="signup-error" class="alert alert-danger d-none"></div>

              <form id="signup-form" class="needs-validation" novalidate>
                <div class="mb-3">
                  <label for="name" class="form-label">Full Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    pattern="^[a-zA-Z\s]{2,50}$"
                    required
                  />
                  <div class="invalid-feedback" id="name-error">
                    Please enter a valid name (2-50 characters, letters only).
                  </div>
                </div>

                <div class="mb-3">
                  <label for="email" class="form-label">Email address</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                    required
                  />
                  <div class="invalid-feedback" id="email-error">
                    Please enter a valid email address.
                  </div>
                </div>

                <div class="mb-3">
                  <label for="phone" class="form-label">Phone Number</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="phone"
                    pattern="[0-9]{10}"
                    required
                  />
                  <div class="invalid-feedback" id="phone-error">
                    Please enter a valid 10-digit phone number.
                  </div>
                </div>

                <div class="mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    minlength="8"
                    required
                  />
                  <div class="password-strength mt-1">
                    <div
                      class="password-strength-bar"
                      id="password-strength-bar"
                    ></div>
                  </div>
                  <div class="password-requirements">
                    <div class="requirement" id="req-length">
                      <i class="bi bi-circle"></i>
                      <span>At least 8 characters</span>
                    </div>
                    <div class="requirement" id="req-number">
                      <i class="bi bi-circle"></i>
                      <span>At least 1 number</span>
                    </div>
                    <div class="requirement" id="req-lowercase">
                      <i class="bi bi-circle"></i>
                      <span>At least 1 lowercase letter</span>
                    </div>
                    <div class="requirement" id="req-uppercase">
                      <i class="bi bi-circle"></i>
                      <span>At least 1 uppercase letter</span>
                    </div>
                    <div class="requirement" id="req-special">
                      <i class="bi bi-circle"></i>
                      <span>At least 1 special character</span>
                    </div>
                  </div>
                  <div class="invalid-feedback" id="password-error">
                    Password must be at least 8 characters long.
                  </div>
                </div>

                <div class="mb-3">
                  <label for="confirm-password" class="form-label"
                    >Confirm Password</label
                  >
                  <input
                    type="password"
                    class="form-control"
                    id="confirm-password"
                    required
                  />
                  <div class="invalid-feedback" id="confirm-password-error">
                    Passwords do not match.
                  </div>
                </div>

                <div class="mb-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="terms"
                      required
                    />
                    <label class="form-check-label" for="terms">
                      I agree to the
                      <span class="terms-link" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</span>
                      and
                      <span class="terms-link" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</span>
                    </label>
                    <div class="invalid-feedback">
                      You must agree to the terms and conditions.
                    </div>
                  </div>
                </div>

                <button type="submit" class="btn btn-danger w-100 py-2 mb-3" id="signup-button">
                  <span class="button-text">Create Account</span>
                  <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                </button>

                <div class="text-center">
                  <p class="mb-0">
                    Already have an account? <a href="login.html">Sign in</a>
                  </p>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Terms and Privacy Modals -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="termsModalLabel">Terms of Service</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <h6>1. Acceptance of Terms</h6>
            <p>By accessing or using our services, you agree to be bound by these terms and conditions.</p>
            
            <h6>2. User Responsibilities</h6>
            <p>You are responsible for maintaining the confidentiality of your account and password.</p>
            
            <h6>3. Prohibited Activities</h6>
            <p>You may not use our services for any illegal or unauthorized purpose.</p>
            
            <h6>4. Intellectual Property</h6>
            <p>All content included on our platform is the property of our company and is protected by copyright laws.</p>
            
            <h6>5. Limitation of Liability</h6>
            <p>We shall not be liable for any indirect, incidental, or consequential damages.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="acceptTerms">I Accept</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <h6>1. Information We Collect</h6>
            <p>We collect personal information that you provide when you register, make a purchase, or interact with our services.</p>
            
            <h6>2. How We Use Your Information</h6>
            <p>We use your information to provide and improve our services, process transactions, and communicate with you.</p>
            
            <h6>3. Data Security</h6>
            <p>We implement security measures to protect your personal information.</p>
            
            <h6>4. Third-Party Services</h6>
            <p>We may use third-party services to process payments and analyze website usage.</p>
            
            <h6>5. Your Rights</h6>
            <p>You have the right to access, update, or delete your personal information.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script src="auth.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // In signup.html, add this at the start of the DOMContentLoaded handler
        if (window.Auth && window.Auth.isUserLoggedIn()) {
          window.location.href = window.Auth.hasCompleteProfile()
            ? "/"
            : "profile.html";
          return;
        }
        const form = document.getElementById("signup-form");
        const errorEl = document.getElementById("signup-error");
        const passwordInput = document.getElementById("password");
        const confirmPasswordInput = document.getElementById("confirm-password");
        const passwordStrengthBar = document.getElementById("password-strength-bar");
        const signupButton = document.getElementById("signup-button");
        const termsCheckbox = document.getElementById("terms");
        const acceptTermsBtn = document.getElementById("acceptTerms");
        
        // Password requirements elements
        const requirements = {
          length: document.getElementById("req-length"),
          number: document.getElementById("req-number"),
          lowercase: document.getElementById("req-lowercase"),
          uppercase: document.getElementById("req-uppercase"),
          special: document.getElementById("req-special")
        };

        // Real-time validation
        document.getElementById("name").addEventListener("input", validateName);
        document
          .getElementById("email")
          .addEventListener("input", validateEmail);
        document
          .getElementById("phone")
          .addEventListener("input", validatePhone);
        passwordInput.addEventListener("input", validatePassword);
        confirmPasswordInput.addEventListener("input", validateConfirmPassword);

        // Password strength indicator
        passwordInput.addEventListener("input", updatePasswordStrength);

        // Set loading state for the signup button
        function setLoading(isLoading, text = 'Creating account...') {
          const button = signupButton;
          const textEl = button.querySelector('.button-text');
          const spinner = button.querySelector('.spinner-border');
          
          if (isLoading) {
            button.disabled = true;
            button.classList.add('is-loading');
            textEl.textContent = text;
            spinner.classList.remove('d-none');
          } else {
            button.disabled = false;
            button.classList.remove('is-loading');
            textEl.textContent = text || 'Create Account';
            spinner.classList.add('d-none');
          }
        }

        // Accept terms button in modal
        if (acceptTermsBtn) {
          acceptTermsBtn.addEventListener('click', function() {
            termsCheckbox.checked = true;
            termsCheckbox.dispatchEvent(new Event('change'));
          });
        }

        // Toggle terms validation
        termsCheckbox.addEventListener('change', function() {
          this.setCustomValidity(this.checked ? '' : 'You must agree to the terms and conditions.');
        });

        form.addEventListener("submit", async function (e) {
          e.preventDefault();
          e.stopPropagation();

          // Validate all fields
          const isNameValid = validateName();
          const isEmailValid = validateEmail();
          const isPhoneValid = validatePhone();
          const isPasswordValid = validatePassword();
          const isConfirmPasswordValid = validateConfirmPassword();
          const isTermsChecked = termsCheckbox.checked;

          // Set custom validity for terms
          termsCheckbox.setCustomValidity(
            isTermsChecked ? '' : 'You must agree to the terms and conditions.'
          );

          if (!isNameValid || !isEmailValid || !isPhoneValid || 
              !isPasswordValid || !isConfirmPasswordValid || !isTermsChecked) {
            form.classList.add("was-validated");
            // Focus on first invalid field
            const firstInvalid = form.querySelector(':invalid');
            if (firstInvalid) {
              firstInvalid.focus();
              // Scroll to the error message
              const errorElement = firstInvalid.nextElementSibling;
              if (errorElement && errorElement.classList.contains('invalid-feedback')) {
                errorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
              }
            }
            return;
          }

          const userData = {
            name: document.getElementById("name").value.trim(),
            email: document.getElementById("email").value.trim().toLowerCase(),
            phone: document.getElementById("phone").value.trim(),
            password: passwordInput.value,
          };

          // Set loading state
          setLoading(true);
          
          // Simulate API call with timeout (replace with actual API call)
          try {
            // Check if email already exists (simulated)
            const users = JSON.parse(localStorage.getItem('aether_users') || '{}');
            if (users[userData.email]) {
              throw new Error('This email is already registered. Please use a different email or sign in.');
            }
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Create user account
            if (Auth.signupUser(userData)) {
              // Get the redirect URL from sessionStorage or default to profile
              const redirectUrl = sessionStorage.getItem("redirectAfterLogin") || "profile.html";

              // Clear any stored redirect URL
              sessionStorage.removeItem("redirectAfterLogin");

              // Show success state
              setLoading(false, 'Account created!');
              
              // Show success message and redirect after a short delay
              setTimeout(() => {
                window.location.href = redirectUrl;
              }, 1000);
            } else {
              throw new Error("Failed to create account. Please try again.");
            }
          } catch (error) {
            setLoading(false);
            showError(error.message || "Failed to create account. Please try again.");
          }
        });

        function validateName() {
          const input = document.getElementById("name");
          const value = input.value.trim();
          const isValid = /^[a-zA-Z\s]{2,50}$/.test(value);

          input.classList.toggle("is-invalid", !isValid && value);
          return isValid;
        }

        function validateEmail() {
          const input = document.getElementById("email");
          const value = input.value.trim();
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          const isValid = emailRegex.test(value);

          input.classList.toggle("is-invalid", !isValid && value);
          return isValid;
        }

        function validatePhone() {
          const input = document.getElementById("phone");
          const value = input.value.trim();
          const isValid = /^[0-9]{10}$/.test(value);

          input.classList.toggle("is-invalid", !isValid && value);
          return isValid;
        }

        function validatePassword() {
          const value = passwordInput.value;
          const isValid = value.length >= 8;

          passwordInput.classList.toggle("is-invalid", !isValid && value);

          // Also validate confirm password when password changes
          if (confirmPasswordInput.value) {
            validateConfirmPassword();
          }

          return isValid;
        }

        function validateConfirmPassword() {
          const value = confirmPasswordInput.value;
          const isValid = value === passwordInput.value;

          confirmPasswordInput.classList.toggle(
            "is-invalid",
            !isValid && value
          );
          return isValid;
        }

        function updatePasswordStrength() {
          const password = passwordInput.value;
          let strength = 0;
          
          // Check requirements
          const hasMinLength = password.length >= 8;
          const hasNumber = /\d/.test(password);
          const hasLowercase = /[a-z]/.test(password);
          const hasUppercase = /[A-Z]/.test(password);
          const hasSpecial = /[^A-Za-z0-9]/.test(password);
          
          // Update requirement indicators
          updateRequirement('length', hasMinLength);
          updateRequirement('number', hasNumber);
          updateRequirement('lowercase', hasLowercase);
          updateRequirement('uppercase', hasUppercase);
          updateRequirement('special', hasSpecial);
          
          // Calculate strength (0-100)
          if (hasMinLength) strength += 20;
          if (hasNumber) strength += 20;
          if (hasLowercase) strength += 20;
          if (hasUppercase) strength += 20;
          if (hasSpecial) strength += 20;
          
          // Update strength bar
          passwordStrengthBar.style.width = strength + "%";
          
          // Update color and text based on strength
          if (strength < 40) {
            passwordStrengthBar.style.backgroundColor = "#dc3545"; // Red
          } else if (strength < 80) {
            passwordStrengthBar.style.backgroundColor = "#ffc107"; // Yellow
          } else {
            passwordStrengthBar.style.backgroundColor = "#198754"; // Green
          }
          
          // Also validate password when strength is updated
          validatePassword();
          
          function updateRequirement(type, isValid) {
            const element = requirements[type];
            if (!element) return;
            
            const icon = element.querySelector('i');
            if (isValid) {
              element.classList.add('valid');
              element.classList.remove('invalid');
              if (icon) icon.className = 'bi bi-check-circle-fill';
            } else {
              element.classList.remove('valid');
              element.classList.add('invalid');
              if (icon) icon.className = 'bi bi-circle';
            }
          }
        }

        function showError(message) {
          errorEl.textContent = message;
          errorEl.classList.remove("d-none");

          // Scroll to error message
          errorEl.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      });
    </script>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
